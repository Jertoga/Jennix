<!-- Forum Section (aanpassingen hier) -->
<section id="forumSection" style="display:none; padding: 20px;">
  <h2>Community Forum</h2>
  <textarea id="postText" placeholder="Share something about Jenna..."></textarea>
  <button id="postBtn">Post</button>
  <div id="posts" style="margin-top: 20px;"></div>
</section>

<!-- Sign In Modal -->
<div id="signInModal" class="modal">
  <div class="modal-content">
    <span class="close-button" onclick="closeSignInModal()">&times;</span>
    <h3>Sign In to Jennix</h3>
    <form id="signInForm">
      <input type="email" id="signInEmail" placeholder="Enter your email" required />
      <input type="password" id="signInPassword" placeholder="Enter your password" required />
      <button type="submit">Sign In</button>
    </form>
    <p class="switch-text">Don't have an account? <a href="#" onclick="switchToSignUp()">Sign Up</a></p>
  </div>
</div>

<!-- Logica Firebase voor Auth en Forum -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDsb7m4EijaU3NNxwoos8y6egI29nfbChk",
    authDomain: "jennix-777e1.firebaseapp.com",
    projectId: "jennix-777e1",
    storageBucket: "jennix-777e1.appspot.com",
    messagingSenderId: "673075142639",
    appId: "1:673075142639:web:ea93e3ae1b244463ca201a",
    measurementId: "G-HKJ85NVGF4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const signInForm = document.getElementById("signInForm");
  const signUpForm = document.getElementById("signUpForm");
  const logoutBtn = document.getElementById("logoutBtn");
  const forumSection = document.getElementById("forumSection");
  const postBtn = document.getElementById("postBtn");
  const postText = document.getElementById("postText");
  const postsDiv = document.getElementById("posts");

  // Sign In
  signInForm.onsubmit = (e) => {
    e.preventDefault();
    const email = document.getElementById("signInEmail").value;
    const password = document.getElementById("signInPassword").value;
    signInWithEmailAndPassword(auth, email, password)
      .then(() => {
        closeSignInModal();
        forumSection.style.display = "block";  // Toon forumsectie na succesvolle login
      })
      .catch(err => alert("Error: " + err.message));
  };

  // Auth state observer (controleer inlogstatus)
  onAuthStateChanged(auth, user => {
    if (user) {
      forumSection.style.display = "block";  // Toon forumsectie als gebruiker is ingelogd
      logoutBtn.style.display = "inline";
    } else {
      forumSection.style.display = "none";  // Verberg forumsectie als niet ingelogd
      logoutBtn.style.display = "none";
      openSignInModal();  // Toon sign-in modal als niet ingelogd
    }
  });

  // Log out
  logoutBtn.onclick = () => {
    signOut(auth);
  };

  // Posten van berichten
  postBtn.onclick = async () => {
    if (postText.value.trim() !== "") {
      await addDoc(collection(db, "posts"), {
        text: postText.value,
        timestamp: new Date()
      });
      postText.value = "";
    }
  };

  // Posts ophalen
  const q = query(collection(db, "posts"), orderBy("timestamp", "desc"));
  onSnapshot(q, snapshot => {
    postsDiv.innerHTML = "";
    snapshot.forEach(doc => {
      const p = document.createElement("p");
      p.textContent = doc.data().text;
      postsDiv.appendChild(p);
    });
  });

  // Modals
  window.openSignInModal = () => {
    document.getElementById("signInModal").style.display = "block";
  };
  window.closeSignInModal = () => {
    document.getElementById("signInModal").style.display = "none";
  };
  window.openSignUpModal = () => {
    document.getElementById("signUpModal").style.display = "block";
  };
  window.closeSignUpModal = () => {
    document.getElementById("signUpModal").style.display = "none";
  };
  window.switchToSignUp = () => {
    closeSignInModal();
    openSignUpModal();
  };
  window.switchToSignIn = () => {
    closeSignUpModal();
    openSignInModal();
  };
</script>
